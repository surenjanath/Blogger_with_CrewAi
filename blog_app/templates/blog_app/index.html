<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post Builder - CrewAI</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'blog_app/css/style.css' %}">
</head>
<body>
    <!-- Left Navigation Bar -->
    <nav class="left-nav">
        <a href="/" class="nav-icon" title="Home">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        </a>
        <a href="/new/" class="nav-icon plus-icon active" title="New Post">+</a>
        <a href="/history/" class="nav-icon" title="History">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        </a>
        <button type="button" class="nav-icon" title="Templates" id="templatesBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        </button>
        <a href="/settings/" class="nav-icon" title="Settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.364 6.364l-4.243-4.243m-4.242 0L5.636 18.364m12.728 0l-4.243-4.243m-4.242 0L5.636 5.636"></path>
            </svg>
        </a>
        <div class="nav-dots">
            <div class="dot yellow" title="Status"></div>
            <div class="dot purple" title="Status"></div>
            <div class="dot green" title="Status"></div>
        </div>
        <button type="button" class="nav-icon" title="Search" id="searchBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        </button>
    </nav>

    <div class="main-container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Create Blog Post</h2>
                <p class="subtitle-text" id="subtitleDisplay">Write about <span id="topicPreview">your topic</span></p>
            </div>

            <form id="blogForm" class="blog-form">
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button type="button" class="quick-btn" id="templateBtn" title="Load Template">üìã Template</button>
                    <button type="button" class="quick-btn" id="clearBtn" title="Clear Form">üóëÔ∏è Clear</button>
                </div>

                <!-- Language Selection -->
                <div class="form-section">
                    <label class="section-label">Language</label>
                    <div class="language-selector">
                        <span class="flag">üá∫üá∏</span>
                        <span>English</span>
                    </div>
                </div>

                <!-- Target Audience -->
                <div class="form-section">
                    <label class="section-label">Target Audience</label>
                    <div class="tags-container" id="audienceTags"></div>
                    <input 
                        type="text" 
                        id="audienceInput" 
                        class="tag-input" 
                        placeholder="Press Enter to add"
                        maxlength="100"
                    >
                    <div class="char-counter">
                        <span id="audienceCount">0</span>/10
                    </div>
                </div>

                <!-- Key Points -->
                <div class="form-section">
                    <label class="section-label">Key Points</label>
                    <textarea 
                        id="keyPoints" 
                        class="text-input" 
                        placeholder="What should be covered?"
                        maxlength="1000"
                        rows="2"
                    ></textarea>
                    <div class="char-counter">
                        <span id="keyPointsCount">0</span>/1000
                    </div>
                </div>

                <!-- Examples -->
                <div class="form-section">
                    <label class="section-label">Examples</label>
                    <textarea 
                        id="examples" 
                        class="text-input" 
                        placeholder="Specific examples or references"
                        maxlength="1000"
                        rows="2"
                    ></textarea>
                    <div class="char-counter">
                        <span id="examplesCount">0</span>/1000
                    </div>
                </div>

                <!-- Crew Configuration -->
                <div class="form-section">
                    <label class="section-label">Crew Configuration</label>
                    <select id="crewConfig" class="tone-select">
                        <option value="">Use Default</option>
                    </select>
                    <a href="/settings/" class="quick-btn" style="margin-top: 6px; width: 100%; text-decoration: none; display: block; text-align: center;">‚öôÔ∏è Manage Settings</a>
                </div>

                <!-- Tone & Length -->
                <div class="form-row">
                    <div class="form-section half-width">
                        <label class="section-label">Tone</label>
                        <select id="tone" class="tone-select">
                            <option value="friendly">üòä Friendly</option>
                            <option value="professional">üíº Professional</option>
                            <option value="casual">üòé Casual</option>
                            <option value="formal">üìã Formal</option>
                            <option value="humorous">üòÑ Humorous</option>
                            <option value="informative">üìö Informative</option>
                        </select>
                    </div>
                    <div class="form-section half-width">
                        <label class="section-label">Length</label>
                        <select id="length" class="tone-select">
                            <option value="short">Short (300-500)</option>
                            <option value="medium" selected>Medium (500-1000)</option>
                            <option value="long">Long (1000+)</option>
                        </select>
                    </div>
                </div>

                <!-- Generate Button -->
                <button type="submit" id="generateBtn" class="generate-btn">
                    <span>‚ö°</span>
                    Generate Blog Post
                </button>

                <button type="button" id="stopBtn" class="stop-btn hidden">
                    <span>‚èπÔ∏è</span>
                    Stop
                </button>
            </form>
        </aside>

        <!-- Right Content Area -->
        <main class="content-area">
            <!-- Toolbar -->
            <div class="toolbar">
                <div class="toolbar-left">
                    <button class="toolbar-btn" id="fileBtn">File</button>
                    <div class="toolbar-divider"></div>
                    <button class="toolbar-btn" title="Undo" id="undoBtn">‚Ü∂</button>
                    <button class="toolbar-btn" title="Redo" id="redoBtn">‚Ü∑</button>
                    <div class="toolbar-divider"></div>
                    <select class="toolbar-select" id="formatSelect">
                        <option>Normal</option>
                        <option>H1</option>
                        <option>H2</option>
                        <option>H3</option>
                    </select>
                    <div class="toolbar-divider"></div>
                    <button class="toolbar-btn" title="Bold" id="boldBtn"><strong>B</strong></button>
                    <button class="toolbar-btn" title="Italic" id="italicBtn"><em>I</em></button>
                    <button class="toolbar-btn" title="Underline" id="underlineBtn"><u>U</u></button>
                    <div class="toolbar-divider"></div>
                    <button class="toolbar-btn" title="Copy" id="copyBtn">üìã</button>
                    <button class="toolbar-btn" title="Download" id="downloadBtn">‚¨áÔ∏è</button>
                </div>
                <div class="toolbar-right">
                    <div class="stats">
                        <span id="wordCount">0 words</span>
                        <span class="divider">‚Ä¢</span>
                        <span id="readTime">0 min read</span>
                    </div>
                    <span class="saved-indicator" id="savedIndicator">‚óè</span>
                    <button class="toolbar-btn hidden" id="saveBtn" onclick="saveCurrentPost()">Save</button>
                    <button class="toolbar-btn" id="exportBtn">Export</button>
                    <button class="toolbar-btn" id="shareBtn">Share</button>
                </div>
            </div>

            <!-- Content Display -->
            <div class="editor-container">
                <!-- Loading State -->
                <div id="loadingSection" class="loading-section hidden">
                    <div class="loading-content">
                        <div class="spinner-large"></div>
                        <h3>Generating your blog post...</h3>
                        <div class="agent-status">
                            <div class="status-item">
                                <span class="status-icon">üîç</span>
                                <span id="researcherStatus">Researching...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-icon">‚úçÔ∏è</span>
                                <span id="writerStatus">Writing...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-icon">üìù</span>
                                <span id="editorStatus">Editing...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Result Display -->
                <div id="resultSection" class="result-section">
                    <div class="editor-content">
                        <h1 id="postTitle" class="post-title">Your Blog Post Will Appear Here</h1>
                        <div id="postContent" class="post-content">
                            <p class="placeholder-text">Enter your topic and preferences, then click "Generate Blog Post" to create your content.</p>
                        </div>
                    </div>
                </div>

                <!-- Error Display -->
                <div id="errorSection" class="error-section hidden">
                    <div class="error-content">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        <h3>Error</h3>
                        <p id="errorText"></p>
                        <button id="retryBtn" class="btn-secondary">Try Again</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="exportModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Blog Post</h3>
                <button class="modal-close" id="closeExportModal">√ó</button>
            </div>
            <div class="modal-body">
                <button class="export-option" id="exportMarkdown">üìÑ Export as Markdown</button>
                <button class="export-option" id="exportText">üìù Export as Text</button>
                <button class="export-option" id="exportHTML">üåê Export as HTML</button>
            </div>
        </div>
    </div>

    <!-- Agent Form Modal -->
    <div id="agentFormModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="agentFormTitle">Add Agent</h3>
                <button class="modal-close" id="closeAgentFormModal">√ó</button>
            </div>
            <div class="modal-body">
                <form id="agentForm">
                    <input type="hidden" id="agentId">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="agentName" required>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <input type="text" id="agentRole" required>
                    </div>
                    <div class="form-group">
                        <label>Goal</label>
                        <textarea id="agentGoal" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Backstory</label>
                        <textarea id="agentBackstory" rows="4" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group half-width">
                            <label>Order</label>
                            <input type="number" id="agentOrder" value="0" min="0">
                        </div>
                        <div class="form-group half-width">
                            <label>
                                <input type="checkbox" id="agentIsActive" checked> Active
                            </label>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelAgentForm">Cancel</button>
                        <button type="submit" class="btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Task Form Modal -->
    <div id="taskFormModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskFormTitle">Add Task</h3>
                <button class="modal-close" id="closeTaskFormModal">√ó</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <input type="hidden" id="taskId">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="taskName" required>
                    </div>
                    <div class="form-group">
                        <label>Agent</label>
                        <select id="taskAgent" required></select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="taskDescription" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Expected Output</label>
                        <textarea id="taskExpectedOutput" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Depends On (Optional)</label>
                        <select id="taskDependsOn">
                            <option value="">None</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group half-width">
                            <label>Order</label>
                            <input type="number" id="taskOrder" value="0" min="0">
                        </div>
                        <div class="form-group half-width">
                            <label>
                                <input type="checkbox" id="taskIsActive" checked> Active
                            </label>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelTaskForm">Cancel</button>
                        <button type="submit" class="btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Crew Form Modal -->
    <div id="crewFormModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="crewFormTitle">Add Crew Configuration</h3>
                <button class="modal-close" id="closeCrewFormModal">√ó</button>
            </div>
            <div class="modal-body">
                <form id="crewForm">
                    <input type="hidden" id="crewId">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="crewName" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="crewDescription" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Process Type</label>
                        <select id="crewProcessType" required>
                            <option value="sequential">Sequential</option>
                            <option value="parallel">Parallel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Agents</label>
                        <div id="crewAgentsList" class="checkbox-list"></div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="crewIsDefault"> Set as Default
                        </label>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelCrewForm">Cancel</button>
                        <button type="submit" class="btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Templates Modal -->
    <div id="templatesModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Blog Post Templates</h3>
                <button class="modal-close" id="closeTemplatesModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="templates-grid">
                    <div class="template-card" data-template="tech">
                        <h4>Tech Blog</h4>
                        <p>Latest technology trends, innovations, and best practices</p>
                        <button class="btn-primary small use-template" data-template="tech">Use Template</button>
                    </div>
                    <div class="template-card" data-template="marketing">
                        <h4>Marketing</h4>
                        <p>Digital marketing strategies, SEO, content marketing</p>
                        <button class="btn-primary small use-template" data-template="marketing">Use Template</button>
                    </div>
                    <div class="template-card" data-template="design">
                        <h4>Design</h4>
                        <p>UI/UX design principles, trends, tools, and best practices</p>
                        <button class="btn-primary small use-template" data-template="design">Use Template</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'blog_app/js/main.js' %}"></script>
    <script>
        // Templates functionality
        const templatesBtn = document.getElementById('templatesBtn');
        const templatesModal = document.getElementById('templatesModal');
        const closeTemplatesModal = document.getElementById('closeTemplatesModal');

        templatesBtn?.addEventListener('click', () => {
            templatesModal.classList.remove('hidden');
        });

        closeTemplatesModal?.addEventListener('click', () => {
            templatesModal.classList.add('hidden');
        });

        templatesModal?.addEventListener('click', (e) => {
            if (e.target === templatesModal) {
                templatesModal.classList.add('hidden');
            }
        });

        // Use template
        document.querySelectorAll('.use-template').forEach(btn => {
            btn.addEventListener('click', () => {
                const template = btn.dataset.template;
                const templates = {
                    tech: {
                        keyPoints: 'Latest technology trends, innovations, and best practices',
                        examples: 'AI, cloud computing, cybersecurity, software development',
                        tone: 'informative',
                        audience: ['Developers', 'Tech Enthusiasts', 'IT Professionals']
                    },
                    marketing: {
                        keyPoints: 'Digital marketing strategies, SEO, content marketing, social media',
                        examples: 'Content marketing, email campaigns, social media trends',
                        tone: 'professional',
                        audience: ['Marketers', 'Business Owners', 'Content Creators']
                    },
                    design: {
                        keyPoints: 'UI/UX design principles, trends, tools, and best practices',
                        examples: 'Design systems, user experience, visual design trends',
                        tone: 'friendly',
                        audience: ['Designers', 'UI/UX Professionals', 'Creatives']
                    }
                };
                
                const templateData = templates[template];
                if (templateData && typeof keyPoints !== 'undefined') {
                    keyPoints.value = templateData.keyPoints;
                    examples.value = templateData.examples;
                    tone.value = templateData.tone;
                    templateData.audience.forEach(tag => {
                        if (typeof addTag !== 'undefined') addTag(tag);
                    });
                    updateTopicPreview();
                    keyPointsCount.textContent = keyPoints.value.length;
                    examplesCount.textContent = examples.value.length;
                    templatesModal.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
